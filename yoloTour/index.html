<!DOCTYPE html>
<html>
	<head>
		<title> Yolo Tour </title>
		<meta charset="utf-8">
		<style>
			body { margin: 0; overflow: hidden;}
			canvas { width: 100%; height: 100%; display: block;}
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>

		<script src="js/TrackballControls.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/Projector.js"></script>
		<script src="js/CanvasRenderer.js"></script>
		<script src="functions.js"></script>
		

		<div id="container"></div>
		
		<script>
		
			var stars = [];
			var materials = []; //stars

			var scene = new THREE.Scene();

			var camera = new THREE.PerspectiveCamera( 60, window.innerWidth/window.innerHeight, 0.1, 1000 );
			camera.position.z = 30;
			scene.add(camera);
			
			var renderer = new THREE.WebGLRenderer({ antialiasing: true });
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			//Skapar en grupp som ska innehålla hela scengrafen
			sceneGraph = new THREE.Object3D;


			renderer.setClearColorHex( 0xB3EAFF, 1.0 );

			scene.fog = new THREE.FogExp2( 0xB3EAFF, 0.007 );




			var A_light = new THREE.AmbientLight( 0xdddddd ); // soft white light
			sceneGraph.add( A_light );
			
			
			loadStars();
			for (var i = 0; i < stars.length; ++i){
				sceneGraph.add(stars[i]);
			}





			sunGroup =new THREE.Object3D;
			//***********************************
			var sunGeometry = new THREE.SphereGeometry( 5, 32, 32 );

			var sunMaterial = new THREE.MeshBasicMaterial({wireframe: false, color: 0xffffaa});
			sunMaterial.map    = THREE.ImageUtils.loadTexture('textures/earth2.jpg');
			var sunSphere = new THREE.Mesh( sunGeometry, sunMaterial );

			sunGroup.add( sunSphere);
			scene.add(sunGroup);


			//---Idéer----

			//Ansikten på planeter
			//Buss som öser runt
			//Moln
			//Musik med synkade rörelser


			//ADD BUS

			busGroup =new THREE.Object3D;
			var busGeometry = new THREE.SphereGeometry( 1, 32, 32 );

			var busMaterial = new THREE.MeshBasicMaterial({wireframe: false, color: 0xffffaa});
			busMaterial.map    = THREE.ImageUtils.loadTexture('textures/rainbow.png');
			var busSphere = new THREE.Mesh( busGeometry, busMaterial );
			busSphere.position.x = 10;
			busGroup.add( busSphere);
			sceneGraph.add(busGroup);




			var loader = new THREE.JSONLoader();
			//************* JSON ***********************

			var yoloText =new THREE.Object3D;

			loader.load("obj/yolotour.js", 

				function(geometry) {

					var objectMaterial = new THREE.MeshLambertMaterial({map: THREE.ImageUtils.loadTexture("textures/earth.jpg"), transparent: true, opacity: 0.5 });

					objectMaterial.side = THREE.DoubleSide;
					object = new THREE.Mesh(geometry, objectMaterial);
					object.rotation.z = -0.07;
					object.translateY(5.5);
					sceneGraph.add(object);

			});

			var pathGeometry = new THREE.TorusGeometry( 10, 0.01, 10, 100 );
			var pathMaterial = new THREE.MeshLambertMaterial({map: THREE.ImageUtils.loadTexture("textures/rainbow.png"), transparent: true, opacity: 0.3 });
			var path = new THREE.Mesh( pathGeometry, pathMaterial );

			path.rotation.x = Math.PI/2; 
			

			sceneGraph.add(path);
			/*			
			galaxyGroup = new THREE.Object3D;
			//**********************************
			var galaxyGeometry = new THREE.SphereGeometry( 300, 32, 32 );
			var galaxyMaterial = new THREE.MeshPhongMaterial();

			//galaxyMaterial.map    = THREE.ImageUtils.loadTexture('textures/space.png');
			//galaxyMaterial.specular  = new THREE.Color('grey');
			galaxyMaterial.side = THREE.DoubleSide;

			var galaxySphere = new THREE.Mesh( galaxyGeometry, galaxyMaterial );

			galaxyGroup.add( galaxySphere);
			//**********************************/

			//sceneGraph.add(galaxyGroup);
			//Lägger till grupper till scengraf
			//galaxyGroup.add(sunGroup);


			//Lägger till scengraf till scen
			scene.add(sceneGraph);

			sceneGraph.rotation.x += 0.1;


			controls = new THREE.TrackballControls( camera );
			controls.zoomSpeed = 1;
			controls.panSpeed = 0;
			controls.rotateSpeed = 0.7;

			var program = function ( context ) {

				context.beginPath();
				context.arc( 0, 0, 0.5, 0, PI2, true );
				context.fill();

			}

			//var group  =new THREE.Object3D;
			//scene.add( group );

			for ( var i = 0; i < 1000; i++ ) {

				var material = new THREE.SpriteCanvasMaterial( {
					color: Math.random() * 0x808008 + 0x808080,
					program: program
				} );

				particle = new THREE.Sprite( material );
				particle.position.x = Math.random() * 2000 - 1000;
				particle.position.y = Math.random() * 2000 - 1000;
				particle.position.z = Math.random() * 2000 - 1000;
				particle.scale.x = particle.scale.y = Math.random() * 20 + 10;
				scene.add( particle );
			}



			window.addEventListener( 'resize', onWindowResize, false );

			

			function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}


			animate();


			function animate() {

				sunSphere.rotation.y += 0.001;
				busGroup.rotation.y += 0.01;
				requestAnimationFrame( animate );
				controls.update();
				renderer.render( scene, camera );
			}





			

		</script>
	</body>
</html>
